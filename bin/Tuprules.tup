!CC = |> gcc -c %f -o %o $(CC_FLAGS) |>
!AR = |> gcc-ar rc %o %f |>
!LD = |> gcc %f -o %o $(LD_FLAGS) |>

SRC = $(TUP_CWD)/../src

# util
UTIL = $(SRC)/util
: foreach $(UTIL)/*.c |> !CC |> util/%B.o
: util/*.o |> !AR |> util.a
CC_FLAGS += -I$(UTIL)

# main
MAIN = $(SRC)/main
LD_FLAGS += -nostdlib -e_entry
LD_FLAGS += -lkernel32 -luser32
: foreach $(MAIN)/*.c |> !CC |> main/%B.o
: main/*.o util.a |> !LD |> main.exe